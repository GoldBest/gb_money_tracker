#!/bin/bash

echo "üßπ –û—á–∏—Å—Ç–∫–∞ Docker –¥–ª—è TG Money MiniApp..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ø–∞–ø–∫–µ
if [ ! -f "docker-compose.yml" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: docker-compose.yml –Ω–µ –Ω–∞–π–¥–µ–Ω. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–µ –ø—Ä–æ–µ–∫—Ç–∞."
    exit 1
fi

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
echo "üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ..."
docker-compose down

# –£–¥–∞–ª—è–µ–º volumes (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ - —ç—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ!)
echo "‚ö†Ô∏è  –£–¥–∞–ª—è—é volumes (–≤—Å–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã!)..."
read -p "–í—ã —É–≤–µ—Ä–µ–Ω—ã? –≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö! (y/N): " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]; then
    docker-compose down -v
    echo "‚úÖ Volumes —É–¥–∞–ª–µ–Ω—ã"
else
    echo "‚ùå Volumes –Ω–µ —É–¥–∞–ª–µ–Ω—ã"
fi

# –£–¥–∞–ª—è–µ–º –æ–±—Ä–∞–∑—ã
echo "üóëÔ∏è  –£–¥–∞–ª—è—é –æ–±—Ä–∞–∑—ã..."
docker rmi $(docker images -q gb-money-miniapp-backend) 2>/dev/null || echo "–û–±—Ä–∞–∑—ã —É–∂–µ —É–¥–∞–ª–µ–Ω—ã"

# –û—á–∏—Å—Ç–∫–∞ Docker —Å–∏—Å—Ç–µ–º—ã
echo "üßπ –û—á–∏—â–∞—é Docker —Å–∏—Å—Ç–µ–º—É..."
docker system prune -f

echo "‚úÖ –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"

echo ""
echo "üí° –î–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω–∏—Ç–µ: ./scripts/dev-docker.sh"
