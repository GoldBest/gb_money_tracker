<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç Frontend - GB Money Tracker</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: 500;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .loading { opacity: 0.6; }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç Frontend - GB Money Tracker</h1>
    
    <div class="test-section">
        <h2>1Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Backend</h2>
        <button onclick="testBackendConnection()">–¢–µ—Å—Ç Backend</button>
        <div id="backend-result"></div>
    </div>

    <div class="test-section">
        <h2>2Ô∏è‚É£ –¢–µ—Å—Ç API Endpoints</h2>
        <button onclick="testAPIEndpoints()">–¢–µ—Å—Ç API</button>
        <div id="api-result"></div>
    </div>

    <div class="test-section">
        <h2>3Ô∏è‚É£ –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö</h2>
        <button onclick="testDataCreation()">–¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è</button>
        <div id="data-result"></div>
    </div>

    <div class="test-section">
        <h2>4Ô∏è‚É£ –¢–µ—Å—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</h2>
        <button onclick="testStatistics()">–¢–µ—Å—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</button>
        <div id="stats-result"></div>
    </div>

    <div class="test-section">
        <h2>5Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ Frontend</h2>
        <button onclick="testFrontend()">–¢–µ—Å—Ç Frontend</button>
        <div id="frontend-result"></div>
    </div>

    <script>
        const BASE_URL = 'https://1b0966126d83.ngrok-free.app';
        let testUserId = null;

        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="test-result ${type}">${message}</div>`;
        }

        async function testBackendConnection() {
            showResult('backend-result', 'üîÑ –ü—Ä–æ–≤–µ—Ä—è—é –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...', 'info');
            
            try {
                const response = await fetch(`${BASE_URL}/api/health`, {
                    headers: {
                        'ngrok-skip-browser-warning': 'true'
                    }
                });
                const data = await response.json();
                
                if (data.status === 'ok') {
                    showResult('backend-result', `‚úÖ Backend —Ä–∞–±–æ—Ç–∞–µ—Ç!<br>–°—Ç–∞—Ç—É—Å: ${data.status}<br>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: ${data.database}<br>–ü–æ—Ä—Ç: ${data.port}`, 'success');
                } else {
                    showResult('backend-result', `‚ùå Backend –≤–µ—Ä–Ω—É–ª –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Å—Ç–∞—Ç—É—Å: ${data.status}`, 'error');
                }
            } catch (error) {
                showResult('backend-result', `‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Backend: ${error.message}`, 'error');
            }
        }

        async function testAPIEndpoints() {
            showResult('api-result', 'üîÑ –¢–µ—Å—Ç–∏—Ä—É—é API endpoints...', 'info');
            
            const endpoints = [
                { name: '–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é', url: '/api/categories/default', method: 'GET' },
                { name: 'Backups', url: '/api/backups', method: 'GET' },
                { name: 'Budget Alerts', url: '/api/budget-alerts', method: 'GET' }
            ];

            let results = [];
            
            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(`${BASE_URL}${endpoint.url}`);
                    if (response.ok) {
                        const data = await response.json();
                        results.push(`‚úÖ ${endpoint.name}: OK`);
                    } else {
                        results.push(`‚ùå ${endpoint.name}: ${response.status}`);
                    }
                } catch (error) {
                    results.push(`‚ùå ${endpoint.name}: ${error.message}`);
                }
            }
            
            showResult('api-result', results.join('<br>'), 'info');
        }

        async function testDataCreation() {
            showResult('data-result', 'üîÑ –¢–µ—Å—Ç–∏—Ä—É—é —Å–æ–∑–¥–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...', 'info');
            
            try {
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const userData = {
                    telegram_id: `test_frontend_${Date.now()}`,
                    username: 'frontend_test',
                    first_name: 'Frontend Test User'
                };
                
                const userResponse = await fetch(`${BASE_URL}/api/users`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(userData)
                });
                
                if (!userResponse.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${userResponse.status}`);
                }
                
                const user = await userResponse.json();
                testUserId = user.id;
                
                // –°–æ–∑–¥–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
                const transactionData = {
                    amount: 200.00,
                    description: '–¢–µ—Å—Ç–æ–≤–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∏–∑ Frontend',
                    type: 'expense',
                    category_id: 1,
                    user_id: testUserId
                };
                
                const transactionResponse = await fetch(`${BASE_URL}/api/transactions`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(transactionData)
                });
                
                if (!transactionResponse.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏: ${transactionResponse.status}`);
                }
                
                const transaction = await transactionResponse.json();
                
                showResult('data-result', `‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ–∑–¥–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ!<br>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ID: ${testUserId}<br>–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è ID: ${transaction.id}<br>–°—É–º–º–∞: ${transaction.amount} —Ä—É–±.`, 'success');
                
            } catch (error) {
                showResult('data-result', `‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö: ${error.message}`, 'error');
            }
        }

        async function testStatistics() {
            if (!testUserId) {
                showResult('stats-result', '‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ', 'info');
                return;
            }
            
            showResult('stats-result', 'üîÑ –ü–æ–ª—É—á–∞—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É...', 'info');
            
            try {
                const response = await fetch(`${BASE_URL}/api/users/${testUserId}/stats`);
                const stats = await response.json();
                
                showResult('stats-result', `‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∞!<br>–î–æ—Ö–æ–¥—ã: ${stats.total_income} —Ä—É–±.<br>–†–∞—Å—Ö–æ–¥—ã: ${stats.total_expense} —Ä—É–±.<br>–ë–∞–ª–∞–Ω—Å: ${stats.balance} —Ä—É–±.<br>–í—Å–µ–≥–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π: ${stats.total_transactions}`, 'success');
                
            } catch (error) {
                showResult('stats-result', `‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: ${error.message}`, 'error');
            }
        }

        function testFrontend() {
            const frontendUrl = 'http://localhost:5173';
            
            showResult('frontend-result', `‚úÖ Frontend –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: <a href="${frontendUrl}" target="_blank">${frontendUrl}</a><br><br>–û—Ç–∫—Ä–æ–π—Ç–µ —Å—Å—ã–ª–∫—É –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.`, 'success');
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', () => {
            setTimeout(() => {
                testBackendConnection();
            }, 1000);
        });
    </script>
</body>
</html>
